<odoo>
	<data>
		<record model="ir.ui.view" id="account_invoice_form">
        <field name="name">Account Invoice</field>
        <field name="model">account.move</field>
		<field name="inherit_id" ref="account.view_move_form"/>
		<field name="arch" type="xml">
			<field name ="payment_reference" position="after">
				<field name="previous_released_amount" readonly="1"/>
			</field>
			<xpath expr="//button[@name='button_draft']" position="replace">
				<button name="button_draft" string="Reset to Draft" type="object" groups="account.group_account_invoice"
                                attrs="{'invisible' : ['|',('show_reset_to_draft_button', '=', False),('payment_state','!=','not_paid')]}" data-hotkey="q" />

			</xpath>
			<xpath expr="//notebook" position="inside">
					<page string="Budgeting Tab" name="budget_info" attrs="{'invisible' : [('move_type', '!=', 'out_invoice')]}">
						<separator string="Assigned Vendor/User"/>
						<field name="inv_budget_line" >
						<tree string="Fixed Budget Line" editable="bottom" create="0" delete="0">
                                <field name="product_id_budget" readonly="1" options="{'no_edit': True, 'no_create': True}"/>
                                <field name="name" readonly="1"/>
                                <field name="bucket_type_id" readonly="1" options="{'no_edit': True, 'no_create': True}"/>
                                <!--<field name="bucket_user" invisible="1"/>-->
                                <field name="is_vendor" invisible="1"/>
                                <field name="check_invoice_posted" invisible="1"/>
                                <field name="assignable_status" readonly="1"/>
<!--                                <field name="budget_inv_vendor_ids" attrs="{'readonly': ['|',('bucket_user', '!=', 'vendor'),('assignable_status', 'in', ('unassigned','assigned'))],}" options="{'no_edit': True, 'no_create': True}" widget="many2many_tags"/>-->
                                <field name="budget_inv_vendor_id" domain="[('supplier_rank', '>', 0)]" attrs="{'readonly': ['|','|',('is_vendor', '!=', True),('assignable_status', 'in', ('unassigned','assigned')),('check_invoice_posted','!=',False)],}" options="{'no_edit': True, 'no_create': True}"/>
<!--                                <field name="budget_user_ids" attrs="{'readonly': ['|','|',('bucket_user', '=', 'vendor'),('assignable_status', 'in', ('unassigned','assigned')),('assignable_status', 'not in', ('unassigned','assigned','assignable_at_inv'))],}" options="{'no_edit': True, 'no_create': True}" widget="many2many_tags"/>-->
                                <field name="budget_user_id" attrs="{'readonly': ['|','|','|',('is_vendor', '=', True),('assignable_status', 'in', ('unassigned','assigned')),('assignable_status', 'not in', ('unassigned','assigned','assignable_at_inv')),('check_invoice_posted','!=',False)],}" options="{'no_edit': True, 'no_create': True}"/>
                                <field name="prod_priority" readonly="1"/>
                                <field name="amount" readonly="1" force_save="1"/>
                                <field name="released" readonly="1" force_save="1"/>
                                <field name="amount_residual" readonly="1" force_save="1"/>
                                <field name="refund_residual" readonly="1" force_save="1"/>
                                <field name="item_refunded" readonly="1" force_save="1"/>
                                
                                    
                            </tree>
                        </field>
						
						<field name="product_remaining_budget_line" widget="section_and_note_one2many" mode="tree">
							<tree string="Remaining Budget line" editable="bottom" create="0" delete="0">
								<field name="product_id_budget" readonly="1" options="{'no_edit': True, 'no_create': True}"/>
								<field name="name" readonly="1"/>
								<field name="bucket_type_id" readonly="1" options="{'no_edit': True, 'no_create': True}"/>
								<!--<field name="bucket_user" invisible="1"/>-->
								<field name="is_vendor" invisible="1"/>
								<field name="check_invoice_posted" invisible="1"/>
								<field name="assignable_status" readonly="1"/>
<!--								<field name="budget_inv_remaining_vendor_ids" attrs="{'readonly': ['|',('bucket_user', '!=', 'vendor'),('assignable_status', 'in', ('unassigned','assignable_at_inv'))],}" options="{'no_edit': True, 'no_create': True}" widget="many2many_tags"/>-->
								<field name="budget_inv_remaining_vendor_id" domain="[('supplier_rank', '>', 0)]" attrs="{'readonly': ['|','|',('is_vendor', '!=', True),('assignable_status', 'in', ('unassigned','assigned')),('check_invoice_posted','!=',False)],}" options="{'no_edit': True, 'no_create': True}"/>
<!--                                <field name="budget_remaining_user_ids" attrs="{'readonly': ['|',('bucket_user', '=', 'vendor'),('assignable_status', 'in', ('unassigned','assignable_at_inv'))],}" options="{'no_edit': True, 'no_create': True}" widget="many2many_tags"/>-->
                                <field name="budget_remaining_user_id" attrs="{'readonly': ['|','|',('is_vendor', '=', True),('assignable_status', 'in', ('unassigned','assigned')),('check_invoice_posted','!=',False)]}" options="{'no_edit': True, 'no_create': True}"/>
								<field name="allocate_percent" readonly="1"/>
								<field name="amount" readonly="1" force_save="1"/>
								<field name="released" readonly="1" force_save="1"/>
								<field name="amount_residual" readonly="1" force_save="1"/>
								<field name="refund_residual" readonly="1" force_save="1"/>
                                <field name="item_refunded" readonly="1" force_save="1"/>
							</tree>
						</field>
					</page>
					
					<page string="Budget Tab" name="budget_val_info" attrs="{'invisible' : [('move_type', '!=', 'in_invoice')]}" >
						<group>
							<field name="bill_bucket_id" options="{'no_edit': True, 'no_create': True}" domain="[('bucket_amount', '>', 0),('bucket_status', '=', 'released')]"/>
						</group>
						<group>
							<field name="bill_bucket_amount" readonly="1"/>
						</group>
						
					</page>
                </xpath>
		</field>
        </record>
    </data>
</odoo>