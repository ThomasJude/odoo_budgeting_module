

<odoo>
	<data>
		<record model="ir.ui.view" id="account_invoice_form">
        <field name="name">Account Invoice</field>
        <field name="model">account.move</field>
		<field name="inherit_id" ref="account.view_move_form"/>
		<field name="arch" type="xml">
			<field name ="payment_reference" position="after">
				<field name="previous_released_amount" readonly="1"/>
			</field>
			<xpath expr="//button[@name='button_draft']" position="replace">
				<button name="button_draft" string="Reset to Draft" type="object" groups="account.group_account_invoice"
                                attrs="{'invisible' : ['|',('show_reset_to_draft_button', '=', False),('payment_state','!=','not_paid')]}" data-hotkey="q" />

			</xpath>
			<xpath expr="//field[@name='partner_id']" position="replace">
				<field name="partner_id" widget="res_partner_many2one" nolabel="1"
                                       context="{
                                            'res_partner_search_mode': (context.get('default_move_type', 'entry') in ('out_invoice', 'out_refund', 'out_receipt') and 'customer') or (context.get('default_move_type', 'entry') in ('in_invoice', 'in_refund', 'in_receipt') and 'supplier') or False,
                                            'show_address': 1, 'default_is_company': True, 'show_vat': True}"
                                       domain="[('type', '!=', 'private'), ('company_id', 'in', (False, company_id)),('supplier_rank', '=', 0),('customer_rank', '=', 0),('is_company','!=',True)]"
                                       options='{"always_reload": True, "no_quick_create": True, "no_create_edit": True}' autocomplete = "off"
                                       attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>

			</xpath>
			<xpath expr="//notebook" position="inside">
					<page string="Budgeting Tab" name="budget_info" attrs="{'invisible' : [('move_type', '!=', 'out_invoice')]}">
						<separator string="Assigned Vendor/User"/>
						<field name="inv_budget_line" >
						<tree string="Fixed Budget Line" editable="bottom" create="0" delete="0">
                                <field name="product_id_budget" readonly="1" options="{'no_edit': True, 'no_create': True}"/>
                                <field name="name" readonly="1"/>
                                <field name="bucket_type_id"  readonly="1" options="{'no_edit': True, 'no_create': True}"/>
                                <!--<field name="bucket_user" invisible="1"/>-->
                                <field name="is_vendor" invisible="1"/>
                                <field name="check_invoice_posted" invisible="1"/>
                                <field name="assignable_status" readonly="1"/>
<!--                                <field name="budget_inv_vendor_ids" attrs="{'readonly': ['|',('bucket_user', '!=', 'vendor'),('assignable_status', 'in', ('unassigned','assigned'))],}" options="{'no_edit': True, 'no_create': True}" widget="many2many_tags"/>-->
                                <field name="budget_inv_vendor_id" domain="[('partner_share', '!=', True),('is_company','!=',True)]" attrs="{'readonly': ['|','|',('is_vendor', '!=', True),('assignable_status', 'in', ('unassigned','assigned')),('check_invoice_posted','!=',False)],}" options="{'no_edit': True, 'no_create': True}"/>
<!--                                <field name="budget_user_ids" attrs="{'readonly': ['|','|',('bucket_user', '=', 'vendor'),('assignable_status', 'in', ('unassigned','assigned')),('assignable_status', 'not in', ('unassigned','assigned','assignable_at_inv'))],}" options="{'no_edit': True, 'no_create': True}" widget="many2many_tags"/>-->
                                <field name="budget_user_id" invisible="1" attrs="{'readonly': ['|','|','|',('is_vendor', '=', True),('assignable_status', 'in', ('unassigned','assigned')),('assignable_status', 'not in', ('unassigned','assigned','assignable_at_inv')),('check_invoice_posted','!=',False)],}" options="{'no_edit': True, 'no_create': True}"/>
                                <field name="prod_priority" readonly="1"/>
                                <field name="amount" sum="Total of Fixed" readonly="1" force_save="1"/>
                                <field name="released" readonly="1" force_save="1"/>
                                <field name="amount_residual" readonly="1" force_save="1"/>
                                <field name="refund_residual" readonly="1" force_save="1"/>
                                <field name="item_refunded" readonly="1" force_save="1"/>
                                
                                    
                            </tree>
                        </field>
						
						<field name="product_remaining_budget_line" widget="section_and_note_one2many" mode="tree">
							<tree string="Remaining Budget line" editable="bottom" create="0" delete="0">
								<field name="product_id_budget" invisible="1" readonly="1" options="{'no_edit': True, 'no_create': True}"/>
								<field name="name" readonly="1" invisible="1"/>
								<field name="bucket_type_id" readonly="1" options="{'no_edit': True, 'no_create': True}"/>
								<!--<field name="bucket_user" invisible="1"/>-->
								<field name="is_vendor" invisible="1"/>
								<field name="check_invoice_posted" invisible="1"/>
								<field name="assignable_status" readonly="1"/>
<!--								<field name="budget_inv_remaining_vendor_ids" attrs="{'readonly': ['|',('bucket_user', '!=', 'vendor'),('assignable_status', 'in', ('unassigned','assignable_at_inv'))],}" options="{'no_edit': True, 'no_create': True}" widget="many2many_tags"/>-->
								<field name="budget_inv_remaining_vendor_id" invisible="1" domain="[('supplier_rank', '>', 0)]" attrs="{'readonly': ['|','|',('is_vendor', '!=', True),('assignable_status', 'in', ('unassigned','assigned')),('check_invoice_posted','!=',False)],}" options="{'no_edit': True, 'no_create': True}"/>
<!--                                <field name="budget_remaining_user_ids" attrs="{'readonly': ['|',('bucket_user', '=', 'vendor'),('assignable_status', 'in', ('unassigned','assignable_at_inv'))],}" options="{'no_edit': True, 'no_create': True}" widget="many2many_tags"/>-->
                                <field name="budget_remaining_user_id" attrs="{'readonly': ['|','|',('is_vendor', '=', True),('assignable_status', 'in', ('unassigned','assigned')),('check_invoice_posted','!=',False)]}" options="{'no_edit': True, 'no_create': True}"/>
								<field name="allocate_percent" readonly="1"/>
								<field name="amount" sum="Total of Remaining" readonly="1" force_save="1"/>
								<field name="released" readonly="1" force_save="1"/>
								<field name="amount_residual" readonly="1" force_save="1"/>
								<field name="refund_residual" readonly="1" force_save="1"/>
                                <field name="item_refunded" readonly="1" force_save="1"/>
							</tree>
						</field>
					</page>

                </xpath>
                <xpath expr = "//field[@name='invoice_line_ids']/tree/field[@name='price_subtotal']" position = "after">
					<field name="parent_move_type" invisible="1"/>
					<field name="is_bill_paid" invisible="1" attrs="{'invisible' : [('parent_move_type', '!=', 'in_invoice')]}"/>
					<field name="is_bill_refunded" invisible="1" attrs="{'invisible' : [('parent_move_type', 'not in', ['in_invoice','in_refund'])]}"/>
					<field name="is_partial" invisible="1" attrs="{'invisible' : [('parent_move_type', '!=', 'in_invoice')]}"/>
					<field name="is_refund_partial" force_save="1" invisible="1" attrs="{'invisible' : [('parent_move_type', 'not in', ['in_invoice'])]}"/>
					<field name="bill_residual_amount" attrs="{'invisible' : [('parent_move_type', '!=', 'in_invoice')]}"/>
					<field name="refund_residual_amount" invisible="0" attrs="{'invisible' : [('parent_move_type', 'not in', ['in_invoice'])]}"/>
				</xpath>
				
				<xpath expr = "//field[@name='invoice_line_ids']/tree/field[@name='product_id']" position = "after">
					<field name="bucket_ids" options="{'no_edit': True, 'no_create': True}" domain="[('bucket_status', '=', 'released')]" attrs="{'readonly' : [('parent.move_type', '!=', 'in_invoice')],'required':[('parent.move_type','=','in_invoice')]}" />
                	<button name="popup_button" type="object" icon="fa-eye-slash" attrs="{'invisible':[('bucket_ids','=',False)]}"/>

				</xpath>



		</field>

        </record>

    </data>
</odoo>